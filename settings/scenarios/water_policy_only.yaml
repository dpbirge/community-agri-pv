# Community Agri-PV Simulation Model Testing Scenario - Layer 2 Configuration
# Focus: Water policy comparison with 4 farms using different water allocation strategies

scenario:
  name: water_policy_testing
  description: "Scenario for water policy testing - comparing groundwater vs municipal water strategies"
  version: "0.2"
  location: "Sinai Peninsula, Red Sea coast, Egypt (~28N, 34E)"
  notes: "MVP simulation for water policy comparison"
  author: "Community Agri-PV Team"

simulation:
  start_date: "2015-01-01"
  end_date: "2024-12-31"
  time_step: daily
  weather_scenario: "001"

# Water pricing configuration
# Critical distinction: Community groundwater (BWRO) vs Municipal seawater (SWRO)
water_pricing:
  # Municipal water source: Seawater desalination (SWRO) delivered via pipeline
  # This is NOT the same as community groundwater desalination
  municipal_source: seawater_desalination  # seawater_desalination or piped_nile

  # Pricing regime: subsidized (government-supported) or unsubsidized (full cost recovery)
  pricing_regime: unsubsidized  # subsidized or unsubsidized

  # Subsidized pricing: Egyptian tiered residential rates (historical)
  # Based on HCWW (Holding Company for Water and Wastewater) published tariffs
  # Very low rates due to government subsidy, but may not be available for agriculture
  subsidized:
    use_tier: 3  # 1, 2, or 3 (higher tiers for higher consumption)
    # Tier 1: $0.02-0.05/m3 (0-10 m3/month, residential low-income)
    # Tier 2: $0.05-0.10/m3 (10-20 m3/month)
    # Tier 3: $0.07-0.15/m3 (20+ m3/month, appropriate for bulk agricultural)
    # Note: Rates loaded from data/prices/water/historical_municipal_water_prices-research.csv

  # Unsubsidized pricing: Full cost recovery for seawater desalination (SWRO)
  # Reflects actual production + delivery cost without government subsidy
  # Appropriate for Sinai communities without access to subsidized Nile water
  unsubsidized:
    base_price_usd_m3: 0.75  # SWRO full cost: $0.50-1.00/m3 (mid-range estimate)
    annual_escalation_pct: 3.0  # Annual price increase (inflation + cost increases)

  # Community groundwater costs are calculated separately from:
  # - Well pumping energy (depth-dependent)
  # - BWRO treatment energy (salinity-dependent, ~3.5-4.5 kWh/m3 for moderate TDS)
  # - Equipment maintenance (membrane replacement, pump maintenance)
  # These are NOT affected by the subsidized/unsubsidized setting above

energy_infrastructure:
  pv:
    sys_capacity_kw: 0
  wind:
    sys_capacity_kw: 0
  battery:
    sys_capacity_kwh: 0
  backup_generator:
    capacity_kw: 0

  # Grid electricity pricing for water treatment energy costs
  grid:
    pricing_regime: subsidized  # subsidized or unsubsidized
    # Note: Rates loaded from data/prices/electricity/historical_grid_electricity_prices-research.csv

water_infrastructure:
  # Community-owned groundwater system (brackish water requiring BWRO treatment)
  groundwater_wells:
    well_depth_m: 50
    well_flow_rate_m3_day: 100
    number_of_wells: 5
    # Total community capacity: 5 wells x 100 m3/day = 500 m3/day

  # Brackish Water Reverse Osmosis (BWRO) treatment for groundwater
  # Different from municipal SWRO - lower energy requirement for lower salinity
  water_treatment:
    treatment_type: bwro  # bwro (brackish) - for community groundwater
    system_capacity_m3_day: 2000  # Total treatment capacity
    number_of_units: 4  # 500 m3/day per unit
    salinity_level: moderate  # light (<3000 TDS), moderate (3000-10000 TDS), heavy (>10000 TDS)
    tds_ppm: 6500  # Actual TDS of groundwater source
    # Energy requirement: ~3.5-4.5 kWh/m3 for moderate salinity BWRO
    # (vs ~4-6 kWh/m3 for seawater SWRO at ~35,000 TDS)

  irrigation_water_storage:
    capacity_m3: 500
    type: reservoir

  irrigation_system:
    type: drip_irrigation  # drip_irrigation (90% eff), sprinkler (75%), furrow (60%)

food_processing_infrastructure:
  fresh_food_packaging:
    equipment:
      - type: washing_sorting_line
        fraction: 1.0
    storage_capacity_kg_total: 20000
    shelf_life_days: 3

  drying:
    equipment:
      - type: solar_tunnel_dryer
        fraction: 0.6
      - type: simple_dehydrator
        fraction: 0.4
    storage_capacity_kg_total: 20000
    shelf_life_days: 180

  canning:
    equipment:
      - type: simple_retort
        fraction: 1.0
    storage_capacity_kg_total: 20000
    shelf_life_days: 365

  packaging:
    equipment:
      - type: packaged
        fraction: 1.0
    storage_capacity_kg_total: 20000
    shelf_life_days: 14

# Community structure and farming layout
community_structure:
  total_farms: 4
  total_area_ha: 500
  community_population: 150

  # Each farm has independent crop allocation and planting schedule
  # Available planting windows: Feb 15, May 1, Aug 15, Nov 1 (quarterly)
  farms:
    - id: farm_1
      name: "Conservative Farm"
      area_ha: 125
      yield_factor: 1.0
      starting_capital_usd: 100000
      policies:
        economic: balanced
        water: always_groundwater  # 100% community groundwater (BWRO treated)
        energy: all_grid
        food: all_fresh
      crops:
        - name: tomato
          area_fraction: 0.30
          planting_date: "02-15"  # Feb 15 planting window (spring crop)
          percent_planted: 0.90
        - name: potato
          area_fraction: 0.25
          planting_date: "01-15"  # Jan 15 (available: 01-15, 04-15, 09-01, 11-15)
          percent_planted: 0.85
        - name: onion
          area_fraction: 0.20
          planting_date: "09-15"  # Sep 15 (available: 02-01, 06-01, 09-15)
          percent_planted: 0.90
        - name: kale
          area_fraction: 0.15
          planting_date: "10-01"  # Oct 1 (available: 01-01, 03-15, 07-01, 10-01)
          percent_planted: 0.85
        - name: cucumber
          area_fraction: 0.10
          planting_date: "03-01"  # Mar 1 (available: 03-01, 06-15, 09-01, 11-15)
          percent_planted: 0.80

    - id: farm_2
      name: "Municipal Water Farm"
      area_ha: 125
      yield_factor: 1.0
      starting_capital_usd: 100000
      policies:
        economic: balanced
        water: always_municipal  # 100% municipal seawater desalination (SWRO)
        energy: all_grid
        food: all_fresh
      crops:
        - name: tomato
          area_fraction: 0.30
          planting_date: "02-15"
          percent_planted: 0.90
        - name: potato
          area_fraction: 0.25
          planting_date: "01-15"
          percent_planted: 0.85
        - name: onion
          area_fraction: 0.20
          planting_date: "09-15"
          percent_planted: 0.90
        - name: kale
          area_fraction: 0.15
          planting_date: "10-01"
          percent_planted: 0.85
        - name: cucumber
          area_fraction: 0.10
          planting_date: "03-01"
          percent_planted: 0.80

    - id: farm_3
      name: "Cost Optimizer Farm"
      area_ha: 125
      yield_factor: 1.0
      starting_capital_usd: 100000
      policies:
        economic: balanced
        water: cheapest_source  # Dynamic: choose cheaper option each day
        energy: all_grid
        food: all_fresh
      crops:
        - name: tomato
          area_fraction: 0.30
          planting_date: "02-15"
          percent_planted: 0.90
        - name: potato
          area_fraction: 0.25
          planting_date: "01-15"
          percent_planted: 0.85
        - name: onion
          area_fraction: 0.20
          planting_date: "09-15"
          percent_planted: 0.90
        - name: kale
          area_fraction: 0.15
          planting_date: "10-01"
          percent_planted: 0.85
        - name: cucumber
          area_fraction: 0.10
          planting_date: "03-01"
          percent_planted: 0.80

    - id: farm_4
      name: "Aquifer Conservation Farm"
      area_ha: 125
      yield_factor: 1.0
      starting_capital_usd: 100000
      policies:
        economic: balanced
        water: conserve_groundwater  # Prefers municipal, GW only when much cheaper
        energy: all_grid
        food: all_fresh
      crops:
        - name: tomato
          area_fraction: 0.30
          planting_date: "02-15"
          percent_planted: 0.90
        - name: potato
          area_fraction: 0.25
          planting_date: "01-15"
          percent_planted: 0.85
        - name: onion
          area_fraction: 0.20
          planting_date: "09-15"
          percent_planted: 0.90
        - name: kale
          area_fraction: 0.15
          planting_date: "10-01"
          percent_planted: 0.85
        - name: cucumber
          area_fraction: 0.10
          planting_date: "03-01"
          percent_planted: 0.80

# Economic parameters
economics:
  currency: USD
  discount_rate: 0.06
  debt:
    principal_usd: 500000
    term_years: 15
    interest_rate: 0.045

# Policy parameters (override defaults)
community_policy_parameters:
  conserve_groundwater:
    price_threshold_multiplier: 1.5  # Use GW only when municipal > 1.5x GW cost
    max_gw_ratio: 0.30  # Never exceed 30% groundwater even when cheaper
