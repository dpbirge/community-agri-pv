# ============================================================================
# SCENARIO METADATA
# ============================================================================
scenario:
  name: single_farm_dev
  description: "Single farm scenario for detailed water, crop, and economic analysis"
  version: "0.1.0"
  location: "Sinai Peninsula, Red Sea coast, Egypt (~28N, 34E)"
  author: "David Birge"

simulation:
  start_date: "2015-01-01"
  end_date: "2020-12-31"
  time_step: daily
  weather_scenario: "001"

# ============================================================================
# WATER SYSTEM
# ============================================================================
water_system:
  groundwater_wells:
    well_depth_m: 50
    salinity_level: moderate
    well_flow_rate_m3_day: 100
    number_of_wells: 5
    aquifer_exploitable_volume_m3: 500000   # estimated exploitable volume (see data/parameters/water/aquifer_parameters.md)
    aquifer_recharge_rate_m3_yr: 5000       # negligible natural recharge in arid Sinai
    max_drawdown_m: 30                      # maximum expected drawdown at full aquifer depletion (50m well)
    financing_status: existing_owned

  water_treatment:
    treatment_type: bwro
    system_capacity_m3_day: 2000
    number_of_units: 4
    salinity_level: moderate
    groundwater_tds_ppm: 6500       # raw groundwater salinity
    municipal_tds_ppm: 300          # municipal supply salinity (post-desalination)
    financing_status: loan_concessional

  conveyance_kwh_per_m3: 0.2       # fixed estimate for pipe conveyance energy (well→treatment→storage)

  irrigation_water_storage:
    capacity_m3: 500
    type: reservoir
    financing_status: existing_owned

  irrigation_system:
    type: drip_irrigation
    financing_status: grant_capex

# ============================================================================
# ENERGY SYSTEM
# ============================================================================
energy_system:
  pv:
    sys_capacity_kw: 500
    tilt_angle: 28
    percent_over_crops: 0.50
    density: medium
    height_m: 3
    financing_status: grant_full

  wind:
    sys_capacity_kw: 100
    type: small
    financing_status: grant_full

  battery:
    sys_capacity_kwh: 200
    units: 2
    chemistry: LFP
    financing_status: loan_standard

  backup_generator:
    capacity_kw: 50
    type: diesel
    max_runtime_hours: 18           # maximum daily generator runtime (hours); reserves 6h for maintenance/cooling
    financing_status: purchased_cash

# ============================================================================
# FOOD PROCESSING SYSTEM
# ============================================================================
food_processing_system:
  fresh_food_packaging:
    equipment:
      - type: washing_sorting_line
        fraction: 1.0
    storage_capacity_kg_total: 20000
    shelf_life_days: 3
    financing_status: loan_standard

  drying:
    equipment:
      - type: solar_tunnel_dryer
        fraction: 0.6
      - type: simple_dehydrator
        fraction: 0.4
    storage_capacity_kg_total: 20000
    shelf_life_days: 180
    financing_status: grant_full

  canning:
    equipment:
      - type: simple_retort
        fraction: 1.0
    storage_capacity_kg_total: 20000
    shelf_life_days: 365
    financing_status: loan_standard

  packaging:
    equipment:
      - type: packaged
        fraction: 1.0
    storage_capacity_kg_total: 20000
    shelf_life_days: 14
    financing_status: existing_owned

# ============================================================================
# COMMUNITY STRUCTURE
# ============================================================================
community_structure:
  community_area_km2: 1000
  total_farms: 1
  total_farming_area_ha: 125
  total_area_ha: 125
  community_population: 30
  houses: 10
  community_buildings:
    office_admin_m2: 500
    storage_warehouse_m2: 1000
    meeting_hall_m2: 300
    workshop_maintenance_m2: 200
  cost_allocation_method: equal  # [equal, area_proportional, usage_proportional]

  # Farms
  farms:
    - id: farm_1
      name: "Demo Farm"
      plantable_area_ha: 100
      yield_factor: 1.0
      starting_capital_usd: 50000
      
      policies:
        economic: balanced_finance
        water: cheapest_source
        energy: all_grid
        food: all_fresh
      
      crops:
        # Tomato: winter-spring + fall-winter (both primary, 124-day gap)
        - name: tomato
          area_fraction: 0.20
          planting_dates: ["02-15", "11-01"]
          percent_planted: 0.90
        # Potato: fall + winter-spring (primary + secondary, 2-day gap)
        - name: potato
          area_fraction: 0.20
          planting_dates: ["09-15", "01-15"]
          percent_planted: 0.85
        # Onion: winter + fall-winter (both primary, 170-day gap)
        - name: onion
          area_fraction: 0.20
          planting_dates: ["01-15", "12-01"]
          percent_planted: 0.90
        # Kale: fall + winter-spring (both primary, 38-day gap)
        - name: kale
          area_fraction: 0.20
          planting_dates: ["10-01", "02-01"]
          percent_planted: 0.85
        # Cucumber: winter-spring + fall (both primary, 103-day gap)
        - name: cucumber
          area_fraction: 0.20
          planting_dates: ["02-15", "09-01"]
          percent_planted: 0.80

# ============================================================================
# POST-HARVEST PARAMETERS
# ============================================================================
post_harvest:
  # Post-harvest handling loss rate: physical losses from bruising, transport
  # damage, and rejected product between harvest and processing intake.
  # Default 0.05 (5%) reflects reduced losses from on-site processing.
  # FAO estimates 10-15% for typical developing-economy supply chains.
  # Applied uniformly to all crops before the food processing split.
  post_harvest_handling_loss_rate: 0.05

# ============================================================================
# COMMUNITY POLICIES
# ============================================================================
community_policy_parameters:
  conserve_groundwater:
    price_threshold_multiplier: 1.5
    max_gw_ratio: 0.30

  quota_enforced:
    annual_quota_m3: 20000
    monthly_variance_pct: 0.15

  aggressive_growth:
    min_cash_months: 1

  conservative:
    min_cash_months: 6

  risk_averse:
    min_cash_months: 3

# ============================================================================
# HOUSEHOLD POLICIES
# ============================================================================
household_policies:
  water_policy: max_municipal        # [max_groundwater, max_municipal]
  energy_policy: renewable_first     # [microgrid, renewable_first, all_grid]

# ============================================================================
# ECONOMICS
# ============================================================================
economics:
  currency: USD
  exchange_rate_egp_per_usd: 49.5  # fixed for simulation run; EGP values converted to USD at load time
  discount_rate: 0.06
  # Note: Debt service is resolved per-subsystem from financing_status and financing_profiles-toy.csv.
  # There is no single economics.debt section — see structure.md and calculations.md Section 5.

# ============================================================================
# PRICING
# ============================================================================
water_pricing:
  municipal_source: seawater_desalination

  agricultural:
    pricing_regime: unsubsidized
    subsidized:
      price_usd_per_m3: 0.75
      annual_escalation_pct: 0.0    # 0 = flat government-fixed rate
    unsubsidized:
      base_price_usd_m3: 0.75
      annual_escalation_pct: 3.0

  domestic:
    pricing_regime: subsidized
    subsidized:
      # Egyptian 5-tier increasing block tariff (2018 decree, EGP values)
      # Converted to USD at load time via economics.exchange_rate_egp_per_usd
      tier_pricing:
        - tier: 1
          max_m3_per_month: 10
          price_egp_per_m3: 0.65
        - tier: 2
          max_m3_per_month: 20
          price_egp_per_m3: 1.60
        - tier: 3
          max_m3_per_month: 30
          price_egp_per_m3: 2.25
        - tier: 4
          max_m3_per_month: 40
          price_egp_per_m3: 2.75
        - tier: 5
          max_m3_per_month: null    # unlimited above tier 4
          price_egp_per_m3: 3.15
      wastewater_surcharge_pct: 75  # applied to water bill total
    unsubsidized:
      base_price_usd_m3: 0.75
      annual_escalation_pct: 3.0

energy_pricing:
  net_metering_ratio: 0.70  # export_price = grid_import_price * this value
  # annual_escalation_pct: applied to all energy prices each year (0 = flat/government-fixed, >0 = inflation-adjusted)
  # Set to 0 for government-fixed pricing, or match inflation rate for escalating scenarios
  agricultural:
    pricing_regime: subsidized
    subsidized:
      price_usd_per_kwh: 0.12
      annual_escalation_pct: 0.0    # 0 = flat government-fixed rate
    unsubsidized:
      price_usd_per_kwh: 0.15
      annual_escalation_pct: 3.0    # matches water escalation rate

  domestic:
    pricing_regime: subsidized
    subsidized:
      price_usd_per_kwh: 0.10
      annual_escalation_pct: 0.0    # 0 = flat government-fixed rate
    unsubsidized:
      price_usd_per_kwh: 0.15
      annual_escalation_pct: 3.0    # matches water escalation rate
